CREATE OR REPLACE PACKAGE TRIGGER_MUTANT_EMPLE IS
NEW_JUG JUGADOR%ROWTYPE:=NULL;
END TRIGGER_MUTANT_EMPLE;

CREATE OR REPLACE TRIGGER TRI_EMP_FILAS
AFTER INSERT OR UPDATE OF EQUIPO_COD_EQUIPO ON JUGADOR FOR EACH ROW
BEGIN
  IF INSERTING THEN
    TRIGGER_MUTANT_EMPLE.NEW_JUG.COD_JUGADOR:=:NEW.COD_JUGADOR;
    TRIGGER_MUTANT_EMPLE.NEW_JUG.NOMBRE:=:NEW.NOMBRE;
    TRIGGER_MUTANT_EMPLE.NEW_JUG.EQUIPO_COD_EQUIPO:=:NEW.EQUIPO_COD_EQUIPO;
  ELSIF UPDATING THEN
    TRIGGER_MUTANT_EMPLE.NEW_JUG.COD_JUGADOR:=:NEW.COD_JUGADOR;
    TRIGGER_MUTANT_EMPLE.NEW_JUG.NOMBRE:=:NEW.NOMBRE;
    TRIGGER_MUTANT_EMPLE.NEW_JUG.EQUIPO_COD_EQUIPO:=:NEW.EQUIPO_COD_EQUIPO;
  END IF;
END;

CREATE OR REPLACE TRIGGER TRI_EMP_TABLA
AFTER INSERT OR UPDATE ON JUGADOR
DECLARE
  NUM_EMPLEADOS NUMBER;
  ERROR_CANTIDAD EXCEPTION;
BEGIN
  SELECT COUNT(COD_JUGADOR) INTO NUM_EMPLEADOS 
  FROM JUGADOR 
  WHERE EQUIPO_COD_EQUIPO=TRIGGER_MUTANT_EMPLE.NEW_JUG.EQUIPO_COD_EQUIPO;

  IF NUM_EMPLEADOS>5 THEN
    RAISE ERROR_CANTIDAD;
  END IF;
  EXCEPTION 
    WHEN ERROR_CANTIDAD THEN
      RAISE_APPLICATION_ERROR(-20001,'NUMERO DE EMPLEADOS EXCEDE EL 5');
END;
